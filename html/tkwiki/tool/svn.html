<!DOCTYPE HTML>
<html>
	<head>
		<link rel="Stylesheet" type="text/css" href="/css/style.css">
		<title>svn @ Tanky Woo's Wiki</title>
		<meta name="keywords" content="Tanky Woo, wiki, makrdown, linux, python, cpp, ops"/>
		<meta name="description" content="Tanky Woo's personal wiki, powered by vim and markdown. Focus on Python, C/C++, Linux, Ops-Dev, Gentoo, and so on."/>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
        <a href="https://github.com/tankywoo/wiki"><img style="position: fixed; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_white_ffffff.png" alt="Fork me on GitHub"></a>
	</head>

	<body>
		<div id="header">
			<ul>
				<li><a href='/'>Home</a></li>
				<li><a href='http://www.wutianqi.com'>Blog</a></li>
				<li><a href='https://github.com/tankywoo/wiki'>Github</a></li>
			</ul>
		</div>
		<div class="clearfix">
		</div>
		<div id="title">svn</div>
		
		<div id="content">

<h1>还原到某个版本</h1>

<ul>
<li>svn up -r 版本号</li>
<li>svn up -r 版本号 文件名</li>
</ul>

<h1>撤销修改</h1>

<ul>
<li>svn revert</li>
</ul>

<h1>diff比较</h1>

<ul>
<li>svn diff                  #将修改后和未修改的比较</li>
<li>svn diff -r 5             #将本地代码和版本好为5的所有文件比较</li>
<li>svn diff -r 5 a.txt       #将本地代码和版本号为5的a.txt文件比较</li>
<li>svn diff -r 5:9           #将比较版本5和版本9之间所有文件比较</li>
<li>svn diff -r 5:9 a.txt     #将版本5和版本9之间的a.txt文件比较</li>
</ul>

<h1>查看log</h1>

<ul>
<li>svn log           #查看所有的log信息</li>
<li>svn log -r 5:9    #只查看版本5和版本9的日志信息</li>
<li>svn log a.txt     #查看文件a.txt的日志修改信息;</li>
<li>svn log -v dir    #查看目录的日志修改信息,需要加v;</li>
</ul>

<h1>svn使用vimdiff</h1>

<p>在 <a href="git.html">git</a> 里提到了git使用vimdiff替换默认的diff工具, svn也可以实现</p>

<p>首先可以写一个小脚本:</p>

<pre><code>#!/bin/sh
# 配置你喜欢的diff程序路径
DIFF="vimdiff"
# SVN diff命令会传入两个文件的参数 
LEFT=${6}
RIGHT=${7}
# 拼接成diff命令所需要的命令格式
$DIFF $LEFT $RIGHT
</code></pre>

<p>可以把脚本放到/usr/bin/svndiff, 然后增加<code>x</code>权限</p>

<p>接着修改svn本地用户配置文件<code>~/.subversion/config</code>, 里面有这么一行:</p>

<pre><code># diff-cmd = diff_program (diff, gdiff, etc.)
</code></pre>

<p>改为</p>

<pre><code>diff-cmd = /usr/bin/svndiff
</code></pre>

<p>然后就可以了</p>

<p>参考了:</p>

<ul>
<li><a href="http://www.ccvita.com/445.html">更换svn diff为vimdiff</a></li>
<li><a href="http://www.blogjava.net/stone2083/archive/2011/05/24/350917.html">使用vimdiff作为svn diff的默认工具</a></li>
</ul>

<h1>diff: file marked as a binary type 问题</h1>

<p>2013-07-25 补充:</p>

<p>今天在 svn diff 看一个 xml 文件时, 显示:</p>

<pre><code>Index: assets-meishan.xml
===================================================================
Cannot display: file marked as a binary type.
svn:mime-type = application/xml
</code></pre>

<p>无法查看, 但是另外一个 xml 文件就可以 diff, 且用 file 命令查看, 都是 <code>XML document text</code></p>

<p>google 了下, 找到了解决方法</p>

<p>方法一:</p>

<pre><code>svn diff --force path/to/file
</code></pre>

<p>方法二:</p>

<p>You can use the <a href="http://svnbook.red-bean.com/en/1.5/svn.ref.properties.html">Subversion property</a> svn:mime-type to set an explicit mimetype on the file:</p>

<pre><code>svn propset svn:mime-type 'text/plain' path/to/file
</code></pre>

<p>Alternatively, you can delete this property (since Subversion assumes plaintext, otherwise) using:</p>

<pre><code>svn propdel svn:mime-type path/to/file
</code></pre>

<p>参考:</p>

<ul>
<li><a href="http://stackoverflow.com/questions/2634043/svn-diff-file-marked-as-binary-type">svn diff: file marked as binary type</a></li>
<li><a href="http://stackoverflow.com/questions/3580092/persistently-overriding-svns-mime-to-binary-mapping">Persistently overriding svn's mime to binary mapping?</a></li>
</ul>

<p><strong>TODO</strong> : 当时是直接用方法一解决的, 抽时间研究下 <code>svn:mine-type</code> 的问题</p>

<h1>修改历史</h1>

<ul>
<li>2013-06-25 : 增加了vimdiff方法</li>
<li>2013-07-25 : 增加 diff: file marked as a binary type 问题</li>
</ul>


		</div>

		<!-- Duoshuo Comment BEGIN -->
		<div class="ds-thread"></div>
		<script type="text/javascript">
		var duoshuoQuery = {short_name:"tkwiki"};
			(function() {
				var ds = document.createElement('script');
				ds.type = 'text/javascript';ds.async = true;
				ds.src = 'http://static.duoshuo.com/embed.js';
				ds.charset = 'UTF-8';
				(document.getElementsByTagName('head')[0] 
				|| document.getElementsByTagName('body')[0]).appendChild(ds);
			})();
			</script>
		<!-- Duoshuo Comment END -->

		<div id="footer">
			<span class="">
				Copyright © 2012-2013 <a href="http://www.wutianqi.com/" target="_blank">Tanky Woo</a>.
				Powered by <a href="http://www.vim.org/" target="_blank">Vim</a> and <a href="http://daringfireball.net/projects/markdown/" target="_blank">Markdown</a>.
				<!-- baidu statistics -->
				<script type="text/javascript">
				var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
				document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3F754de327571c0ba7ff50a61fc964e196' type='text/javascript'%3E%3C/script%3E"));
				</script>
				<!-- baidu statistics end -->
			</span>
		</div>
	</body>

	<!-- add _blank to outer links -->
	<script type="text/javascript">
	$("a[href^='http://']").each(function(){
			this.target = "_blank";
	});
	$("a[href^='https://']").each(function(){
			this.target = "_blank";
	});
	</script>
</html>
