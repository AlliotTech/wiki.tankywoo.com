<!DOCTYPE HTML>
<html>
	<head>
		<link rel="Stylesheet" type="text/css" href="/css/style.css">
		<title>tmux @ Tanky Woo's Wiki</title>
		<meta name="keywords" content="Tanky Woo, wiki, makrdown, linux, python, cpp, ops"/>
		<meta name="description" content="Tanky Woo's personal wiki, powered by vim and markdown. Focus on Python, C/C++, Linux, Ops-Dev, Gentoo, and so on."/>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
        <a href="https://github.com/tankywoo/wiki"><img style="position: fixed; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_white_ffffff.png" alt="Fork me on GitHub"></a>
	</head>

	<body>
		<div id="header">
			<ul>
				<li><a href='/'>Home</a></li>
				<li><a href='http://www.wutianqi.com'>Blog</a></li>
				<li><a href='https://github.com/tankywoo/wiki'>Github</a></li>
			</ul>
		</div>
		<div class="clearfix">
		</div>
		<div id="title">tmux</div>
		
		<div id="content">

<h1>TMUX - terminal multiplexer</h1>

<p>前序: <a href="http://www.wutianqi.com/?p=3676">布道 Tmux</a></p>

<p>三个术语:</p>

<ul>
<li>session: 管理多个window的会话</li>
<li>window: 一个window就是整个屏幕</li>
<li>pane: 一个window可以被横向或纵向分割为多个pane, 也就是俗称的分屏</li>
</ul>

<p>tmux有很多组合键, 类似screen, tmux的组合键前缀(prefix)默认是<code>C-b</code>, 如果习惯了screen的<code>C-a</code>, 可以修改prefix, 以下都用<code>C-b</code>表示前缀</p>

<h1>基本操作</h1>

<ul>
<li><code>C-b :</code> 进入tmux的命令行模式</li>
<li><code>C-b ?</code> 显示所有的bind-key</li>
<li><code>C-b [</code> 进入复制模式</li>
<li><code>C-b ]</code> 进入粘贴模式</li>
</ul>

<p>如果有设置 <code>setw -g mode-keys vi</code> 的话，可按 vi 的按键模式操作。移动至待复制的文本处，按一下空格，结合 vi 移动命令开始选择，选好后按回车确认.</p>

<h1>session 操作</h1>

<ul>
<li><code>C-b d</code> deattch当前的session</li>
<li><code>C-b C-z</code> 挂起当前的session</li>
<li><code>tmux attach [-t sessionname]</code> 恢复session</li>
<li><code>C-b $</code> 可以重命名当前的session</li>
<li><code>tmux ls</code> 显示tmux的所有session</li>
</ul>

<h1>window 操作</h1>

<ul>
<li><code>C-b c</code> 可以新建一个新的window</li>
<li><code>C-b &amp;</code> 关闭当前的window</li>
<li><code>C-b ,</code> 可以重命名当前的window</li>
<li><code>C-b p</code> 切换到前一个window</li>
<li><code>C-b n</code> 切换到后一个window</li>
<li><code>C-b l</code> 切换到上一次的window</li>
<li><code>C-b number</code> 切换到指定编号的window, 默认从0开始</li>
<li><code>C-b w</code> 显示当前会话的window, 可以通过上下选择来切换</li>
<li><code>tmux neww -n tmux</code> 新建一个window, 名称是tmux</li>
</ul>

<h1>pane 操作</h1>

<ul>
<li><code>C-b "</code> 将当前window横向分割为两个pane</li>
<li><code>C-b %</code> 将当前window纵向分割为两个pane</li>
<li><code>C-b 方向键</code> 在当前window里移动到其他pane</li>
<li><code>C-b o</code> 切换到下一个pane</li>
<li><code>C-b Alt+方向键</code> 调整pane的大小</li>
<li><code>C-b q</code> 显示pane的编号</li>
<li><code>C-b x</code> 关闭当前的pane, 会有确认提示. 也可以直接C-d</li>
<li><code>C-b {</code> 把当前的pane移到左边</li>
<li><code>C-b }</code> 把当前的pane移到右边</li>
<li><code>C-b z</code> 把当前pane最大化/恢复. 感谢 yanyaoer 和 陈兴明Mingo 两位同学, tmux 升级到 1.8 后有这个特性了.</li>
</ul>

<h1>配置文件</h1>

<p><a href="https://github.com/tankywoo/linux-autoconfig/blob/master/.tmux.conf">我的tmux配置</a></p>

<p>以下配置就不更新了, 最近的请访问上面链接</p>

<pre><code>set -g default-terminal "screen-256color"   # use 256 colors
set -g display-time 5000                    # status line messages display
set -g status-utf8 on                       # enable utf-8
set -g history-limit 100000                 # scrollback buffer n lines
setw -g mode-keys vi                        # use vi mode

# start window indexing at one instead of zero
set -g base-index 1

# set the prefix key and some key bindings to match GNU Screen
set -g prefix C-a
unbind-key C-b
bind-key C-a send-prefix

# key bindings for horizontal and vertical panes
unbind %
bind | split-window -h
unbind '"'
bind - split-window -v

# enable window titles
#set -g set-titles on

# window title string (uses statusbar variables)
set -g set-titles-string '#T'

# status bar with load and time
set -g status-bg '#4e4e4e'
set -g status-fg '#bbbbbb'
set -g status-left-fg '#55ff55'
set -g status-left-bg '#555555'
set -g status-right-fg '#55ff55'
set -g status-right-bg '#555555'
set -g status-left-length 90
set -g status-right-length 90
set -g status-left '[#(whoami)]'
set -g status-right '[#(date +" %m-%d %H:%M ")]'
set -g status-justify "centre"
set -g window-status-format '#I #W'
set -g window-status-current-format ' #I #W '
setw -g window-status-current-bg '#B3D9D9'
setw -g window-status-current-fg '#DDDDFF'

# pane border colors
set -g pane-active-border-fg '#55ff55'
set -g pane-border-fg '#555555'

# bind to reload config
bind r source-file ~/.tmux.conf

# add window to session
new -s tankywoo -n tankywoo
neww -n ops-dev
selectw -t 1

# scripting tmux
bind T source-file ~/.tmux/tanky
</code></pre>

<h1>脚本化tmux</h1>

<p><em>* 脚本化这个是 Tmux 的一大亮点, 不用就太浪费了 *</em></p>

<p>脚本化可以让我们自己定义一些脚本, 来构造自己的tmux布局</p>

<p>比如我写了一个分割三个pane的小脚本放在 ~/.tmux/tanky 里:</p>

<pre><code>select-pane -t 0
split-window -h -p 60
select-pane -t 1
split-window -v -p 25
send-keys -t 0 'ipython' C-m
# The C-m at the end is interpreted by Tmux as the enter key.
select-pane -t 1
</code></pre>

<p>google搜出来的讲解tmux脚本化的E文不少, 不过没几个解释了 <code>C-m</code> 是干嘛的, 查看绑定键也没找到 <br />
后来在<a href="http://spin.atomicobject.com/2013/04/11/tmux-key-binding-scripting/">An Introduction to Scripting Tmux Key Bindings</a>上看到了解释.</p>

<blockquote>
  <p>The C-m at the end is interpreted by Tmux as the enter key.</p>
</blockquote>

<p>在 ~/.tmux.conf 里绑定快捷键: bind T source-file ~/.tmux/tanky</p>

<p>这样, 就可以通过快捷键 C-b S-t 一键初始化一个如下图的布局.
<img src="http://wutianqi-wiki.b0.upaiyun.com/tmux_new.png" alt="Script Tmux" /></p>

<p>另外, 还可以直接写shell脚本, 然后运行, 比如:</p>

<pre><code>#!/bin/bash
# Tanky Woo@2013-06-19 10:51:15
# About:

tmux start-server

if ! $(tmux has-session -t 'tankywoo'); then
        tmux new-session -d -s 'tankywoo' -n 'tankywoo' # -d *
        tmux select-window -t 'tankywoo'
        tmux split-window -h -p 60
        tmux select-pane -t 1
        tmux split-window -v -p 25
        tmux send-keys -t 0 'ipython' C-m
        # The C-m at the end is interpreted by Tmux as the enter key.

        tmux new-window -n 'ops-dev'

        tmux select-window -t 'tankywoo'
        tmux select-pane -t 1
fi

tmux attach-session -d -t 'tankywoo'
</code></pre>

<p>下面这几个链接不错</p>

<ul>
<li><a href="http://amjith.blogspot.com/2011/08/scripting-tmux-layouts.html">Scripting Tmux Layouts</a></li>
<li><a href="http://blog.htbaa.com/news/tmux-scripting">TMUX SCRIPTING</a></li>
<li><a href="http://toastdriven.com/blog/2009/oct/09/scripting-tmux/">Scripting tmux</a></li>
</ul>

<h1>技巧</h1>

<h2>批量操作</h2>

<p>当需要在多个机器执行相同操作时, 可以考虑用<code>pdsh</code>等内容分发的工具, 而tmux也有它的一种强悍的方式. 在一个windows里打开多个pane, 每个pane登录一台服务器, 设置windows的选项, 在其中一个pane上操作时, 其它pane都会复制相同的操作.</p>

<p>在tmux的命令行里, 使用选项<code>set synchronize-panes on</code>即可.</p>

<h1>扩展 - tmux powerline</h1>

<ul>
<li><a href="https://github.com/erikw/tmux-powerline">tmux-powerline项目</a> 官方说此项目现在只做维护, 不更新</li>
<li><a href="https://github.com/Lokaltog/powerline">powerline项目</a> 这个是最新项目</li>
</ul>

<h1>其他资料</h1>

<ul>
<li><a href="http://www.dayid.org/os/notes/tm.html">screen and tmux</a> screen和tmux的操作对比</li>
<li><a href="https://wiki.archlinux.org/index.php/Tmux">Tmux - ArchWIKI</a> 对tmux介绍的非常详细</li>
<li><a href="http://blog.hawkhost.com/2010/06/28/tmux-the-terminal-multiplexer/">TMUX – The Terminal Multiplexer (Part 1)</a></li>
<li><a href="https://wiki.freebsdchina.org/software/t/tmux">使用tmux</a></li>
</ul>

<h1>历史记录</h1>

<ul>
<li>2013-06-25 : 完善整个tmux wiki</li>
<li>2013-07-04 : 补充批量操作技巧</li>
<li>2013-07-29 : 开头引进博客的tmux简介; 对脚本化的强调说明;</li>
<li>2013-08-05 : 补充 C-b z 特性</li>
</ul>


		</div>

		<!-- Duoshuo Comment BEGIN -->
		<div class="ds-thread"></div>
		<script type="text/javascript">
		var duoshuoQuery = {short_name:"tkwiki"};
			(function() {
				var ds = document.createElement('script');
				ds.type = 'text/javascript';ds.async = true;
				ds.src = 'http://static.duoshuo.com/embed.js';
				ds.charset = 'UTF-8';
				(document.getElementsByTagName('head')[0] 
				|| document.getElementsByTagName('body')[0]).appendChild(ds);
			})();
			</script>
		<!-- Duoshuo Comment END -->

		<div id="footer">
			<span class="">
				Copyright © 2012-2013 <a href="http://www.wutianqi.com/" target="_blank">Tanky Woo</a>.
				Powered by <a href="http://www.vim.org/" target="_blank">Vim</a> and <a href="http://daringfireball.net/projects/markdown/" target="_blank">Markdown</a>.
				<!-- baidu statistics -->
				<script type="text/javascript">
				var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
				document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3F754de327571c0ba7ff50a61fc964e196' type='text/javascript'%3E%3C/script%3E"));
				</script>
				<!-- baidu statistics end -->
			</span>
		</div>
	</body>

	<!-- add _blank to outer links -->
	<script type="text/javascript">
	$("a[href^='http://']").each(function(){
			this.target = "_blank";
	});
	$("a[href^='https://']").each(function(){
			this.target = "_blank";
	});
	</script>
</html>
