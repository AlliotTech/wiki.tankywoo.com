<!DOCTYPE HTML>
<html>
  <head>
    <link rel="Stylesheet" type="text/css" href="/static/css/colorful.css">
    <link rel="Stylesheet" type="text/css" href="/static/css/style.css">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="alternate" type="application/atom+xml" href="atom.xml" title="Atom feed">
    <title>FreeBSD - Wiki · Tanky Woo</title>
    <meta name="keywords" content="wiki, makrdown, linux, python, cpp, ops, simiki"/>
    <meta name="description" content="Tanky Woo's personal wiki, powered by vim and markdown. Focus on Python, C/C++, Linux, Ops-Dev, Gentoo, and so on."/>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
  </head>

  <body>
    <div id="container" class="typo">
      
<div id="header">
  <div id="post-nav">
    <a href="/">Wiki · Tanky Woo</a>
    &nbsp;&#187;&nbsp;
    <a href="/#linux">linux</a>
    &nbsp;&#187;&nbsp;FreeBSD
    <span class="updated">当前页面最后更新&nbsp;
    2016-09-15 17:00
    
    </span>
  </div>
</div>
<div class="clearfix"></div>
<div id="content">
  <div class="toc"><span class="toctitle">Table of Contents</span><ul>
<li><a href="#_1">基本</a></li>
<li><a href="#_2">安装/更新软件</a><ul>
<li><a href="#pkg">pkg</a></li>
<li><a href="#ports">ports</a></li>
<li><a href="#_3">查看哪些软件可以升级</a></li>
<li><a href="#_4">查看已安装的软件包是通过什么方式安装的</a></li>
</ul>
</li>
<li><a href="#_5">遇到的问题</a><ul>
<li><a href="#make-config">make config配置</a></li>
<li><a href="#cron">cron任务</a></li>
</ul>
</li>
</ul>
</div>
<h2 id="_1">基本</h2>
<p>目前10.3是RELEASE版，11.0还是BETA</p>
<p>一般下载disc1.iso就可以，大概700MB；dvd1是比较齐全的，大概2个多G；memstick好像是写入U盘的，具体没试过，大小也是700M左右。</p>
<p>安装和基本使用参考<a href="https://www.freebsd.org/doc/zh_CN.UTF-8/books/handbook/index.html">FreeBSD使用手册</a>就足够了。</p>
<p>其它参考：</p>
<ul>
<li><a href="http://bsdelf.github.io/posts/freebsd-brief-user-guide/">FreeBSD 简明用户指南</a></li>
<li><a href="https://wiki.freebsdchina.org/start">freebsdchina</a></li>
<li><a href="quiver-file-url/871494DBDDBEF4ABDF120C463796CB52.pdf">FreeBSD 9.0 安装入门教程.pdf</a></li>
<li><a href="https://www.freebsd.org/doc/handbook/book.html">FreeBSD Handbook</a></li>
</ul>
<p>修改源：</p>
<p>pkg源主页：<a href="http://pkg.freebsd.org/">pkg.freebsd.org</a></p>
<p>FreeBSD 10.x版本和之前貌似不同，需要修改<code>/etc/pkg/FreeBSD.conf</code>:</p>
<div class="hlcode"><pre>FreeBSD: <span class="o">{</span>
  url: <span class="s2">&quot;pkg+http://pkg0.twn.freebsd.org/${ABI}/latest/&quot;</span>,  <span class="c"># 这个源没被墙</span>
  mirror_type: <span class="s2">&quot;srv&quot;</span>,
  signature_type: <span class="s2">&quot;fingerprints&quot;</span>,
  fingerprints: <span class="s2">&quot;/usr/share/keys/pkg&quot;</span>,
  enabled: yes
<span class="o">}</span>
</pre></div>


<p>额外参考：</p>
<ul>
<li><a href="https://www.freebsdchina.org/forum/viewtopic.php?t=67003">freebsd10怎么修改pkg的源？</a></li>
</ul>
<p>权限，普通用户需要属于组<code>wheel</code>才能使用<code>su</code>命令，否则报Sorry；直接修改<code>/etc/group</code>或者执行<code>pw user mod tankywoo -G wheel</code></p>
<p>可以安装sudo工具。<a href="http://unix.stackexchange.com/questions/116470/whats-the-sudo-equivalent-for-freebsd">参考</a></p>
<blockquote>
<p>通常情况下， 强烈建议不要去更改 root 用户的默认 Shell。原因是这些 Shell 没有包括在基本系统中，正常情况下它们会被安装到 /usr/local/bin 和 /usr/bin 目录下。万一某天 /usr/local/bin 和 /usr/bin 的文件系统不能被挂载， 这样情况下 root 将不能进入自己默认的 Shell，从而 root 将不能够登录进去。 鉴于这个原因，第二个系统管理员帐户 toor 创建时使用的是非默认的 Shell。 <a href="https://www.freebsd.org/doc/zh_CN/articles/linux-users/shells.html">来源</a></p>
</blockquote>
<p>所以root还是使用csh，登录配置为<code>~/.cshrc</code>，增加以下几项：</p>
<div class="hlcode"><pre><span class="nb">alias </span>ls        ls -G
<span class="nb">alias </span>ll        ls -al
<span class="nb">alias </span>rm        rm -i
<span class="nb">alias </span>mv        mv -i

<span class="nb">set </span><span class="nv">path</span> <span class="o">=</span> <span class="o">(</span><span class="nv">$HOME</span>/.local/bin /sbin /bin /usr/sbin /usr/bin /usr/games /usr/local/sbin /usr/local/bin <span class="nv">$HOME</span>/bin<span class="o">)</span>  <span class="c"># 主要是增加~/.local/bin</span>

setenv  EDITOR  vim
</pre></div>


<p>第二个系统管理用户改为bash，参考 <a href="http://linux.it.net.cn/m/view.php?aid=8444">Freebsd下安装bash</a>。其中<code>/etc/shells</code>会自动更新。</p>
<p>make install后最后的提示不清楚有什么用：</p>
<div class="hlcode"><pre><span class="n">Installing</span> <span class="n">bash</span><span class="o">-</span><span class="mf">4.3.46</span><span class="n">_1</span><span class="p">...</span>
<span class="o">======================================================================</span>

<span class="n">bash</span> <span class="n">requires</span> <span class="n">fdescfs</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="n">mounted</span> <span class="n">on</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">fd</span>

<span class="n">If</span> <span class="n">you</span> <span class="n">have</span> <span class="n">not</span> <span class="n">done</span> <span class="n">it</span> <span class="n">yet</span><span class="p">,</span> <span class="n">please</span> <span class="k">do</span> <span class="n">the</span> <span class="n">following</span><span class="o">:</span>

        <span class="n">mount</span> <span class="o">-</span><span class="n">t</span> <span class="n">fdescfs</span> <span class="n">fdesc</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">fd</span>

<span class="n">To</span> <span class="n">make</span> <span class="n">it</span> <span class="n">permanent</span><span class="p">,</span> <span class="n">you</span> <span class="n">need</span> <span class="n">the</span> <span class="n">following</span> <span class="n">lines</span> <span class="n">in</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">fstab</span><span class="o">:</span>

        <span class="n">fdesc</span>   <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">fd</span>         <span class="n">fdescfs</span>         <span class="n">rw</span>      <span class="mi">0</span>       <span class="mi">0</span>

<span class="o">======================================================================</span>
</pre></div>


<p>修改提示符在csh下是<code>prompt</code>环境变量：</p>
<div class="hlcode"><pre><span class="nb">set </span><span class="nv">prompt</span> <span class="o">=</span> <span class="s2">&quot; # &quot;</span> 
</pre></div>


<p>主机名、网络配置在<code>/etc/rc.conf</code>里。</p>
<p>看内存：安装<code>freecolor</code>，执行<code>freecolor -m -o</code>；<code>swapinfo</code>看swap。</p>
<p>参考：<a href="http://stackoverflow.com/questions/4093786/what-is-equivalent-of-linuxs-free-command-on-freebsd-v8-1">What is equivalent of Linux's 'free' command on FreeBSD v8.1</a> / <a href="http://www.cyberciti.biz/faq/freebsd-command-to-get-ram-information/">FreeBSD find out RAM size Including Total Amount of Free and Used Memory Size</a></p>
<p>折腾MOTD：<code>/etc/motd</code>，以及<code>cowsay</code>, <code>fortune</code>等。</p>
<p>参考：<a href="https://www.linux.com/learn/put-talking-cow-your-linux-message-day">Put a Talking Cow in Your Linux Message of the Day</a> / <a href="http://www.mewbies.com/how_to_customize_your_console_login_message_tutorial.htm">CUSTOMIZE YOUR MOTD</a></p>
<h2 id="_2">安装/更新软件</h2>
<p>参考：</p>
<ul>
<li><a href="https://www.digitalocean.com/community/tutorials/how-to-install-and-manage-ports-on-freebsd-10-1">How To Install and Manage Ports on FreeBSD 10.1</a></li>
<li><a href="https://www.digitalocean.com/community/tutorials/how-to-manage-packages-on-freebsd-10-1-with-pkg">How To Manage Packages on FreeBSD 10.1 with Pkg</a></li>
</ul>
<h3 id="pkg">pkg</h3>
<p>FreeBSD 10.x 之前的命令貌似叫 <code>pkg_add</code>, <code>pkg_info</code>等，10.x 之后就<code>pkg</code>命令，<code>install</code>这些都是pkg的子命令。</p>
<p>这个是安装二进制包，所以没法定制，但是安装速度很快。</p>
<p>通过disc1安装的FreeBSD，默认没有<code>pkg</code>命令，第一次敲会提示安装，Yes确认即可。默认的源安装不上，可以按上面修改源地址。</p>
<div class="hlcode"><pre><span class="nv">$ </span>pkg search python  <span class="c"># 搜索</span>
<span class="nv">$ </span>pkg install python27-2.7.12  <span class="c"># 安装</span>
<span class="nv">$ </span>pkg info python27-2.7.12  <span class="c"># 查看信息</span>
<span class="nv">$ </span>pkg upgrade &lt;pakcage&gt;  <span class="c"># 升级软件</span>
</pre></div>


<h3 id="ports">ports</h3>
<p>第一次使用ports需要更新</p>
<div class="hlcode"><pre><span class="nv">$ </span>portsnap fetch extract
<span class="nv">$ </span>portsnap update
</pre></div>


<p>虽然执行了第一步，但是看<code>/usr/ports/</code>下有内容，可能只需要第二步就可以了。</p>
<p>安装软件：</p>
<div class="hlcode"><pre><span class="nv">$ </span>whereis tmux
tmux: /usr/ports/sysutils/tmux

<span class="nv">$ </span><span class="nb">cd</span> /usr/ports/sysutils/tmux
<span class="nv">$ </span>make
<span class="nv">$ </span>make install
</pre></div>


<p>更新软件:</p>
<div class="hlcode"><pre><span class="nv">$ </span>make <span class="o">&amp;&amp;</span> make reinstall
</pre></div>


<p>中间会有一些安装包的选项提示(勾选)。</p>
<p>安装后二进制bin文件默认在<code>/usr/local/bin/</code>下：</p>
<div class="hlcode"><pre><span class="err">$</span> <span class="n">whereis</span> <span class="n">tmux</span>
<span class="nl">tmux:</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">tmux</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">man</span><span class="o">/</span><span class="n">man1</span><span class="o">/</span><span class="n">tmux</span><span class="mf">.1</span><span class="p">.</span><span class="n">gz</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">ports</span><span class="o">/</span><span class="n">sysutils</span><span class="o">/</span><span class="n">tmux</span>
</pre></div>


<p>安装<code>pip</code>和<code>setuptools</code>:</p>
<div class="hlcode"><pre><span class="nv">$ </span>python -m ensurepip
Ignoring indexes: https://pypi.python.org/simple
Collecting setuptools
Collecting pip
Installing collected packages: setuptools, pip
Successfully installed pip-8.1.1 setuptools-20.10.1
</pre></div>


<p>参考 <a href="http://serverfault.com/questions/694665/how-to-install-python3-4-pip-in-freebsd-10-1">How to install python3.4-pip in FreeBSD 10.1?</a></p>
<h3 id="_3">查看哪些软件可以升级</h3>
<p><code>pkg version -v</code> 可以显示所有安装的软件以及哪些可以升级。</p>
<p>参考<a href="https://www.freebsd.org/doc/zh_CN.UTF-8/books/handbook/ports-using.html">使用Ports Collection</a></p>
<h3 id="_4">查看已安装的软件包是通过什么方式安装的</h3>
<p>输出最后一栏如果是 FreeBSD则是二进制；unknown-repository则是ports安装</p>
<p>参考：<a href="https://www.reddit.com/r/freebsd/comments/3mc0ss/list_of_installed_ports/">https://www.reddit.com/r/freebsd/comments/3mc0ss/list_of_installed_ports/</a></p>
<div class="hlcode"><pre><span class="nv">$ </span>pkg query --all <span class="s1">&#39;%o %n-%v $R&#39;</span>
</pre></div>


<h2 id="_5">遇到的问题</h2>
<h3 id="make-config">make config配置</h3>
<p>安装vim时，在make开始就会有config配置的ncurser窗口，让选择安装哪些，和Gentoo的USE类似，可以把X11去掉，改为console，只安装CUI版本。(其实不装X11等，编译安装还是很快的)</p>
<p>之前安装vim时，配置有问题，导致无法make:</p>
<div class="hlcode"><pre><span class="nv">make</span>
<span class="o">====</span>&gt; You must <span class="k">select </span>one and only one option from the UI single
*** Error code 1

Stop.
make<span class="o">[</span>1<span class="o">]</span>: stopped in /usr/ports/editors/vim
*** Error code 1

Stop.
make: stopped in /usr/ports/editors/vim
</pre></div>


<p>这时<code>make clean</code>无用，需要再次调出之前的ncurser窗口，执行<code>make config</code>重新配置；<code>make showconfig</code>查看配置；<code>make rmconfig</code>删除配置。</p>
<h3 id="cron">cron任务</h3>
<p>每天上午11点负载会莫名飙到3，甚至5。</p>
<p>排查后发现原来时区不对，<code>/etc/crontab</code>默认有个daily任务，每天3点进行日常维护，正好就是错误时区下的上午11点。（通过<code>md5</code>(unix下不是md5sum)确认时区文件/etc/localtime是Shanghai, zone文件也都在/usr/share/zoneinfo/下）。</p>
  
</div>
    </div>
    <div id="footer">
      <div class="footer-left">
        <p>
        Copyright © 2012-2017 Tanky Woo.
        Powered by <a href="http://simiki.org/" target="_blank">Simiki</a>.
        Theme by <a href="https://git.coding.net/tankywoo/yasimple_x2.git" target="_blank">YASimple_X2</a>.
        </p>
        <p>本作品采用<a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议</a>进行许可。</p>
      </div> <!-- end footer-left -->
      <div class="footer-right">
        <p>站点最后生成 2017-08-25 16:16:57</p>
        <p><a href="https://github.com/tankywoo/wiki.tankywoo.com">Fork me on Github</a></p>
        <p><a href="http://www.miitbeian.gov.cn/">京ICP备16016622号</a></p>
      </div> <!-- end footer-right -->
    </div>

    
    

    <script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3F754de327571c0ba7ff50a61fc964e196' type='text/javascript'%3E%3C/script%3E"));
    </script>
  </body>
</html>