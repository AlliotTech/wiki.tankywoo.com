<!DOCTYPE HTML>
<html>
  <head>
    <link rel="Stylesheet" type="text/css" href="/static/css/colorful.css">
    <link rel="Stylesheet" type="text/css" href="/static/css/style.css">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="alternate" type="application/atom+xml" href="atom.xml" title="Atom feed">
    <title>Ubuntu - Wiki · Tanky Woo</title>
    <meta name="keywords" content="wiki, makrdown, linux, python, cpp, ops, simiki"/>
    <meta name="description" content="Tanky Woo's personal wiki, powered by vim and markdown. Focus on Python, C/C++, Linux, Ops-Dev, Gentoo, and so on."/>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
  </head>

  <body>
    <div id="container" class="typo">
      
<div id="header">
  <div id="post-nav">
    <a href="/">Wiki · Tanky Woo</a>
    &nbsp;&#187;&nbsp;
    <a href="/#linux">linux</a>
    &nbsp;&#187;&nbsp;Ubuntu
    <span class="updated">最后更新&nbsp;
    2016-09-03 17:45
    
    </span>
  </div>
</div>
<div class="clearfix"></div>
<div id="content">
  <div class="toc"><span class="toctitle">Table of Contents</span><ul>
<li><a href="#_1">基本</a><ul>
<li><a href="#apt-key">apt-key</a></li>
</ul>
</li>
<li><a href="#_2">经验</a><ul>
<li><a href="#remove-vs-purge">remove vs purge</a></li>
<li><a href="#_3">查询指定包的反向依赖</a></li>
<li><a href="#_4">更新</a></li>
<li><a href="#_5">安全更新</a></li>
</ul>
</li>
<li><a href="#_6">问题</a><ul>
<li><a href="#syntax-error-unknown-group-ssl-cert-in-statoverride-file">syntax error: unknown group 'ssl-cert' in statoverride file</a></li>
<li><a href="#the-following-packages-have-unmet-dependencies">The following packages have unmet dependencies</a></li>
<li><a href="#files-list-file-for-package-xxx-is-missing-final-newline">files list file for package 'xxx' is missing final newline</a></li>
<li><a href="#timezone">配置timezone(时区)</a></li>
</ul>
</li>
</ul>
</div>
<p><img alt="Ubuntu Logo" src="http://design.ubuntu.com/wp-content/uploads/ubuntu-orange.gif" /></p>
<ul>
<li><a href="http://www.ubuntu.com/server">Ubuntu官网</a></li>
<li><a href="https://help.ubuntu.com/">Ubuntu Help</a></li>
</ul>
<h2 id="_1">基本</h2>
<h3 id="apt-key">apt-key</h3>
<p>APT key管理工具</p>
<p>有时添加第三方的apt源，需要添加授权的key保证源是安全可信的。</p>
<p>比如添加salt源并操作<code>apt-get update</code>之前需要先添加key <code>apt-key add &lt;key_file&gt;</code>:</p>
<div class="hlcode"><pre><span class="nv">$ </span>wget -O - https://repo.saltstack.com/apt/ubuntu/16.04/amd64/latest/SALTSTACK-GPG-KEY.pub | sudo apt-key add -
</pre></div>


<p>列出已有的key <code>apt-key list</code>:</p>
<div class="hlcode"><pre><span class="nv">$ </span>apt-key list
/etc/apt/trusted.gpg
--------------------

pub   2048R/DE57BFBE 2014-06-24
uid                  SaltStack Packaging Team &lt;packaging@saltstack.com&gt;
sub   2048R/17928113 2014-06-24
</pre></div>


<p>其中keyid是DE57BFBE</p>
<p>删除指定的key <code>apt-key del &lt;keyid&gt;</code></p>
<div class="hlcode"><pre><span class="nv">$ </span>apt-key del DE57BFBE
</pre></div>


<h2 id="_2">经验</h2>
<h3 id="remove-vs-purge">remove vs purge</h3>
<p><code>apt-get</code> 的 <code>remove</code> 和 <code>purge</code> 区别:</p>
<ul>
<li><code>remove</code>: 只删除软件包, 保留配置文件</li>
<li><code>purge</code>: 删除软件包和配置文件</li>
</ul>
<p>这里的配置文件是指包添加的系统配置, 不包括用户自定义的配置.</p>
<p>参考:</p>
<ul>
<li>man apt-get</li>
<li><a href="http://askubuntu.com/questions/231562/what-is-the-difference-between-apt-get-purge-and-apt-get-remove">What is the Difference Between <code>apt-get purge</code> and <code>apt-get remove</code>?</a></li>
<li><a href="http://askubuntu.com/questions/187888/what-is-the-correct-way-to-completely-remove-an-application">What is the correct way to completely remove an application?</a></li>
</ul>
<h3 id="_3">查询指定包的反向依赖</h3>
<p>即查看哪些包依赖指定的包.</p>
<div class="hlcode"><pre><span class="nx">apt</span><span class="na">-cache</span> <span class="nx">rdepends</span> <span class="o">&lt;</span><span class="nx">package</span><span class="o">&gt;</span>
</pre></div>


<p>showpkg也可以, 不过包含的内容更多一些:</p>
<div class="hlcode"><pre><span class="nx">apt</span><span class="na">-cache</span> <span class="nx">showpkg</span> <span class="o">&lt;</span><span class="nx">package</span><span class="o">&gt;</span>
</pre></div>


<p>查看哪些<strong>已安装</strong>的包依赖指定的包:</p>
<div class="hlcode"><pre><span class="nx">apt</span><span class="na">-cache</span> <span class="nx">rdepends</span> <span class="o">--</span><span class="nx">installed</span> <span class="o">&lt;</span><span class="nx">package</span><span class="o">&gt;</span>
</pre></div>


<p>更多可以<code>man 8 apt-cache</code></p>
<p>参考:</p>
<ul>
<li><a href="http://askubuntu.com/questions/128524/how-to-list-dependent-packages-reverse-dependencies">How to list dependent packages</a></li>
<li><a href="http://askubuntu.com/questions/5636/can-i-see-why-a-package-is-installed">Can I see why a package is installed?</a></li>
</ul>
<h3 id="_4">更新</h3>
<div class="hlcode"><pre><span class="err">$</span> <span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">update</span>        <span class="err">#</span> <span class="n">Fetches</span> <span class="n">the</span> <span class="n">list</span> <span class="n">of</span> <span class="n">available</span> <span class="n">updates</span>
<span class="err">$</span> <span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">upgrade</span>       <span class="err">#</span> <span class="n">Strictly</span> <span class="n">upgrades</span> <span class="n">the</span> <span class="n">current</span> <span class="n">packages</span>
<span class="err">$</span> <span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">dist</span><span class="o">-</span><span class="n">upgrade</span>  <span class="err">#</span> <span class="n">Installs</span> <span class="n">updates</span> <span class="p">(</span><span class="n">new</span> <span class="n">ones</span><span class="p">)</span>
</pre></div>


<p><code>update</code>负责更新可更新的软件列表，<code>upgrade</code>更新已装的包，<code>dist-upgrade</code>更新需要新安装的包。</p>
<p>比如在upgrade时，提示</p>
<div class="hlcode"><pre><span class="err">$</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">upgrade</span>
<span class="p">...</span>
<span class="n">The</span> <span class="n">following</span> <span class="n">packages</span> <span class="n">were</span> <span class="n">automatically</span> <span class="n">installed</span> <span class="n">and</span> <span class="n">are</span> <span class="n">no</span> <span class="n">longer</span> <span class="n">required</span><span class="o">:</span>
  <span class="n">linux</span><span class="o">-</span><span class="n">headers</span><span class="o">-</span><span class="mf">4.4.0</span><span class="o">-</span><span class="mi">21</span> <span class="n">linux</span><span class="o">-</span><span class="n">headers</span><span class="o">-</span><span class="mf">4.4.0</span><span class="o">-</span><span class="mi">21</span><span class="o">-</span><span class="n">generic</span> <span class="n">linux</span><span class="o">-</span><span class="n">image</span><span class="o">-</span><span class="mf">4.4.0</span><span class="o">-</span><span class="mi">21</span><span class="o">-</span><span class="n">generic</span> <span class="n">linux</span><span class="o">-</span><span class="n">image</span><span class="o">-</span><span class="n">extra</span><span class="o">-</span><span class="mf">4.4.0</span><span class="o">-</span><span class="mi">21</span><span class="o">-</span><span class="n">generic</span>
<span class="n">Use</span> <span class="err">&#39;</span><span class="n">apt</span> <span class="n">autoremove</span><span class="err">&#39;</span> <span class="n">to</span> <span class="n">remove</span> <span class="n">them</span><span class="p">.</span>
<span class="n">The</span> <span class="n">following</span> <span class="n">packages</span> <span class="n">have</span> <span class="n">been</span> <span class="n">kept</span> <span class="n">back</span><span class="o">:</span>
  <span class="n">linux</span><span class="o">-</span><span class="n">generic</span> <span class="n">linux</span><span class="o">-</span><span class="n">headers</span><span class="o">-</span><span class="n">generic</span> <span class="n">linux</span><span class="o">-</span><span class="n">image</span><span class="o">-</span><span class="n">generic</span>
<span class="n">The</span> <span class="n">following</span> <span class="n">packages</span> <span class="n">will</span> <span class="n">be</span> <span class="n">upgraded</span><span class="o">:</span>
<span class="p">...</span>
</pre></div>


<p>在dist-upgrade时，提示：</p>
<div class="hlcode"><pre><span class="err">$</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">dist</span><span class="o">-</span><span class="n">upgrade</span>
<span class="p">...</span>
<span class="n">The</span> <span class="n">following</span> <span class="n">packages</span> <span class="n">were</span> <span class="n">automatically</span> <span class="n">installed</span> <span class="n">and</span> <span class="n">are</span> <span class="n">no</span> <span class="n">longer</span> <span class="n">required</span><span class="o">:</span>
  <span class="n">linux</span><span class="o">-</span><span class="n">headers</span><span class="o">-</span><span class="mf">4.4.0</span><span class="o">-</span><span class="mi">21</span> <span class="n">linux</span><span class="o">-</span><span class="n">headers</span><span class="o">-</span><span class="mf">4.4.0</span><span class="o">-</span><span class="mi">21</span><span class="o">-</span><span class="n">generic</span> <span class="n">linux</span><span class="o">-</span><span class="n">image</span><span class="o">-</span><span class="mf">4.4.0</span><span class="o">-</span><span class="mi">21</span><span class="o">-</span><span class="n">generic</span> <span class="n">linux</span><span class="o">-</span><span class="n">image</span><span class="o">-</span><span class="n">extra</span><span class="o">-</span><span class="mf">4.4.0</span><span class="o">-</span><span class="mi">21</span><span class="o">-</span><span class="n">generic</span>
<span class="n">Use</span> <span class="err">&#39;</span><span class="n">apt</span> <span class="n">autoremove</span><span class="err">&#39;</span> <span class="n">to</span> <span class="n">remove</span> <span class="n">them</span><span class="p">.</span>
<span class="n">The</span> <span class="n">following</span> <span class="n">NEW</span> <span class="n">packages</span> <span class="n">will</span> <span class="n">be</span> <span class="n">installed</span><span class="o">:</span>
  <span class="n">linux</span><span class="o">-</span><span class="n">headers</span><span class="o">-</span><span class="mf">4.4.0</span><span class="o">-</span><span class="mi">28</span> <span class="n">linux</span><span class="o">-</span><span class="n">headers</span><span class="o">-</span><span class="mf">4.4.0</span><span class="o">-</span><span class="mi">28</span><span class="o">-</span><span class="n">generic</span> <span class="n">linux</span><span class="o">-</span><span class="n">image</span><span class="o">-</span><span class="mf">4.4.0</span><span class="o">-</span><span class="mi">28</span><span class="o">-</span><span class="n">generic</span> <span class="n">linux</span><span class="o">-</span><span class="n">image</span><span class="o">-</span><span class="n">extra</span><span class="o">-</span><span class="mf">4.4.0</span><span class="o">-</span><span class="mi">28</span><span class="o">-</span><span class="n">generic</span>
<span class="n">The</span> <span class="n">following</span> <span class="n">packages</span> <span class="n">will</span> <span class="n">be</span> <span class="n">upgraded</span><span class="o">:</span>
  <span class="n">linux</span><span class="o">-</span><span class="n">generic</span> <span class="n">linux</span><span class="o">-</span><span class="n">headers</span><span class="o">-</span><span class="n">generic</span> <span class="n">linux</span><span class="o">-</span><span class="n">image</span><span class="o">-</span><span class="n">generic</span>
<span class="p">...</span>
</pre></div>


<p>即更新linux-headers, linux-image等相关的包</p>
<p>参考：<a href="http://askubuntu.com/questions/196768/how-to-install-updates-via-command-line">How to install updates via command line?</a></p>
<h3 id="_5">安全更新</h3>
<p>和上面基本一样。</p>
<p>Ubuntu的包版本在当前发行版(如12.04)release出来后，版本号基本是不会变的，后期有安全更新，都是以patch形式增加。</p>
<p>比如openssl，经常爆出漏洞，虽然官方是建议建议到1.0.1t等当前最新版本，不过ubuntu下针对这些安全更新都增加了patch。</p>
<p>首先<code>apt-get update</code>更新软件包树，如果有更新一是<code>apt-get upgrade</code>会提示；另外还可以通过<code>source</code>来确认：</p>
<div class="hlcode"><pre><span class="err">$</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">source</span> <span class="n">openssl</span>
</pre></div>


<p>会将openssl的debian目录tar包等下载下来：</p>
<div class="hlcode"><pre><span class="cp"># ls</span>
<span class="n">debian</span>  <span class="c1">// openssl_1.0.1-4ubuntu5.36.debian.tar.gz解压后的目录</span>
<span class="n">openssl_1</span><span class="mf">.0.1</span><span class="o">-</span><span class="mi">4u</span><span class="n">buntu5</span><span class="mf">.36</span><span class="p">.</span><span class="n">debian</span><span class="p">.</span><span class="n">tar</span><span class="p">.</span><span class="n">gz</span>
<span class="n">openssl_1</span><span class="mf">.0.1</span><span class="o">-</span><span class="mi">4u</span><span class="n">buntu5</span><span class="mf">.36</span><span class="p">.</span><span class="n">dsc</span>
<span class="n">openssl_1</span><span class="mf">.0.1</span><span class="p">.</span><span class="n">orig</span><span class="p">.</span><span class="n">tar</span><span class="p">.</span><span class="n">gz</span>

<span class="err">$</span> <span class="n">ls</span> <span class="n">debian</span><span class="o">/</span><span class="n">patches</span><span class="o">/</span><span class="n">CVE</span><span class="o">-</span><span class="mi">2016</span><span class="o">-</span><span class="mf">2107.</span><span class="n">patch</span>
</pre></div>


<p>比如最近的安全漏洞CVE-2016-2107，目前就给出了修复patch, 版本是openssl_1.0.1-4ubuntu5.36</p>
<p>然后更新：</p>
<div class="hlcode"><pre><span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="n">openssl</span>
<span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="n">libssl1</span><span class="mf">.0.0</span>
</pre></div>


<p>注意，对于openssl，要更新libssl1.0.0, openssl只是相关的工具包，而libssl1.0.0才是动态库的更新。具体可以看debian/control文件。</p>
<p>更新完记得重启nginx。</p>
<h2 id="_6">问题</h2>
<h3 id="syntax-error-unknown-group-ssl-cert-in-statoverride-file">syntax error: unknown group 'ssl-cert' in statoverride file</h3>
<p>安装某个包时遇到这个报错:</p>
<div class="hlcode"><pre><span class="err">$</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="n">libffi</span><span class="o">-</span><span class="n">dev</span>
<span class="n">Reading</span> <span class="n">package</span> <span class="n">lists</span><span class="p">...</span> <span class="n">Done</span>
<span class="n">Building</span> <span class="n">dependency</span> <span class="n">tree</span>
<span class="n">Reading</span> <span class="n">state</span> <span class="n">information</span><span class="p">...</span> <span class="n">Done</span>
<span class="n">The</span> <span class="n">following</span> <span class="n">NEW</span> <span class="n">packages</span> <span class="n">will</span> <span class="n">be</span> <span class="n">installed</span><span class="o">:</span>
  <span class="n">libffi</span><span class="o">-</span><span class="n">dev</span>
<span class="mi">0</span> <span class="n">upgraded</span><span class="p">,</span> <span class="mi">1</span> <span class="n">newly</span> <span class="n">installed</span><span class="p">,</span> <span class="mi">0</span> <span class="n">to</span> <span class="n">remove</span> <span class="n">and</span> <span class="mi">18</span> <span class="n">not</span> <span class="n">upgraded</span><span class="p">.</span>
<span class="n">Need</span> <span class="n">to</span> <span class="n">get</span> <span class="mi">0</span> <span class="n">B</span><span class="o">/</span><span class="mf">96.1</span> <span class="n">kB</span> <span class="n">of</span> <span class="n">archives</span><span class="p">.</span>
<span class="n">After</span> <span class="n">this</span> <span class="n">operation</span><span class="p">,</span> <span class="mi">356</span> <span class="n">kB</span> <span class="n">of</span> <span class="n">additional</span> <span class="n">disk</span> <span class="n">space</span> <span class="n">will</span> <span class="n">be</span> <span class="n">used</span><span class="p">.</span>
<span class="nl">dpkg:</span> <span class="n">unrecoverable</span> <span class="n">fatal</span> <span class="n">error</span><span class="p">,</span> <span class="n">aborting</span><span class="o">:</span>
 <span class="n">syntax</span> <span class="n">error</span><span class="o">:</span> <span class="n">unknown</span> <span class="n">group</span> <span class="err">&#39;</span><span class="n">ssl</span><span class="o">-</span><span class="n">cert</span><span class="err">&#39;</span> <span class="n">in</span> <span class="n">statoverride</span> <span class="n">file</span>
<span class="nl">E:</span> <span class="n">Sub</span><span class="o">-</span><span class="n">process</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">dpkg</span> <span class="n">returned</span> <span class="n">an</span> <span class="n">error</span> <span class="n">code</span> <span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>


<p>其实提示还是很清楚了, statoverride文件有一个未知的用户组ssl-cert.</p>
<p>这个组其实是Apache建立的. 个人猜测应该是在卸载Apache时, 用的remove而不是purge导致.</p>
<p>文件在/var/lib/dpkg/statoverride:</p>
<div class="hlcode"><pre><span class="err">$</span> <span class="n">cat</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">dpkg</span><span class="o">/</span><span class="n">statoverride</span>
<span class="n">root</span> <span class="n">mlocate</span> <span class="mi">2755</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">mlocate</span>
<span class="n">root</span> <span class="n">ssl</span><span class="o">-</span><span class="n">cert</span> <span class="mi">710</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">ssl</span><span class="o">/</span><span class="n">private</span>
<span class="n">root</span> <span class="n">Debian</span><span class="o">-</span><span class="n">exim</span> <span class="mi">640</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">exim4</span><span class="o">/</span><span class="n">passwd</span><span class="p">.</span><span class="n">client</span>
<span class="n">root</span> <span class="n">stapusr</span> <span class="mi">4750</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">staprun</span>
<span class="n">root</span> <span class="n">crontab</span> <span class="mi">2755</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">crontab</span>
</pre></div>


<p>这个的作用可以<a href="http://manpages.ubuntu.com/manpages/trusty/man8/dpkg-statoverride.8.html"><code>man 8 dpkg-statoverride</code></a>:</p>
<blockquote>
<p>override ownership and mode of files</p>
<p>`stat overrides' are a way to tell dpkg(1) to use a different owner or mode for a path when a package is installed</p>
</blockquote>
<h3 id="the-following-packages-have-unmet-dependencies">The following packages have unmet dependencies</h3>
<div class="hlcode"><pre><span class="n">Reading</span> <span class="n">package</span> <span class="n">lists</span><span class="p">...</span> <span class="n">Done</span>
<span class="n">Building</span> <span class="n">dependency</span> <span class="n">tree</span>
<span class="n">Reading</span> <span class="n">state</span> <span class="n">information</span><span class="p">...</span> <span class="n">Done</span>
<span class="n">You</span> <span class="n">might</span> <span class="n">want</span> <span class="n">to</span> <span class="n">run</span> <span class="err">&#39;</span><span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="o">-</span><span class="n">f</span> <span class="n">install</span><span class="err">&#39;</span> <span class="n">to</span> <span class="n">correct</span> <span class="n">these</span><span class="o">:</span>
<span class="n">The</span> <span class="n">following</span> <span class="n">packages</span> <span class="n">have</span> <span class="n">unmet</span> <span class="n">dependencies</span><span class="o">:</span>
 <span class="n">pack_1</span> <span class="o">:</span> <span class="n">Depends</span><span class="o">:</span> <span class="n">pack_2</span> <span class="n">but</span> <span class="n">it</span> <span class="n">is</span> <span class="n">not</span> <span class="n">going</span> <span class="n">to</span> <span class="n">be</span> <span class="n">installed</span>
 <span class="nl">E:</span> <span class="n">Unmet</span> <span class="n">dependencies</span><span class="p">.</span> <span class="n">Try</span> <span class="err">&#39;</span><span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="o">-</span><span class="n">f</span> <span class="n">install</span><span class="err">&#39;</span> <span class="n">with</span> <span class="n">no</span> <span class="n">packages</span> <span class="p">(</span><span class="n">or</span> <span class="n">specify</span> <span class="n">a</span> <span class="n">solution</span><span class="p">).</span>
</pre></div>


<p>之前dpkg安装包pack_1, 依赖pack_2;</p>
<p>未安装pack_2前先安装pack_1则出现这个问题, 不过安装pack_2就可以了.</p>
<p>但是pack_2之前是另外一个名称, 导致改名后的deb安装不了.</p>
<p>尝试:</p>
<div class="hlcode"><pre><span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="o">-</span><span class="n">f</span> <span class="n">install</span>
<span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">purge</span> <span class="n">pack_2_origin_name</span>
</pre></div>


<p>都不行.</p>
<p>后来发现<code>dpkg --purge package</code> 可以删除老的包.</p>
<p>参考: <a href="http://linuxg.net/how-to-overwrite-existing-files-from-another-package-in-ubuntu-and-debian/">How To Overwrite Existing Files From A Removed Package in Ubuntu and Debian</a></p>
<h3 id="files-list-file-for-package-xxx-is-missing-final-newline">files list file for package 'xxx' is missing final newline</h3>
<p>报错:</p>
<div class="hlcode"><pre><span class="p">(</span><span class="n">Reading</span> <span class="n">database</span> <span class="p">...</span> <span class="mi">95</span><span class="o">%</span><span class="n">dpkg</span><span class="o">:</span> <span class="n">unrecoverable</span> <span class="n">fatal</span> <span class="n">error</span><span class="p">,</span> <span class="n">aborting</span><span class="o">:</span>
  <span class="n">files</span> <span class="n">list</span> <span class="n">file</span> <span class="k">for</span> <span class="n">package</span> <span class="err">&#39;</span><span class="n">xxx</span><span class="err">&#39;</span> <span class="n">is</span> <span class="n">missing</span> <span class="n">final</span> <span class="n">newline</span>
  <span class="nl">E:</span> <span class="n">Sub</span><span class="o">-</span><span class="n">process</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">dpkg</span> <span class="n">returned</span> <span class="n">an</span> <span class="n">error</span> <span class="n">code</span> <span class="p">(</span><span class="mi">2</span><span class="p">))</span>
</pre></div>


<p>通过<code>apt-get purge</code>或<code>dpkg -P</code>都无法卸载包。</p>
<p>参考<a href="http://askubuntu.com/a/350508/434496">这篇回答</a>, 发现是 <code>/var/lib/dpkg/info</code> 下那个包的文件损坏了, 文件内容有乱码导致, 删掉即可.</p>
<h3 id="timezone">配置timezone(时区)</h3>
<div class="hlcode"><pre><span class="nv">$ </span>dpkg-reconfigure tzdata
</pre></div>


<p>基本和Gentoo的方式一样，通过/etc/timezone的配置，修改/etc/localtime。执行命令时会显示一个交互式的窗口，更新会同时写入/etc/timezone和/etc/localtime。可以直接写文件而不进入交互方式：</p>
<div class="hlcode"><pre><span class="nv">$ </span>dpkg-reconfigure -u tzdata
</pre></div>
  
</div>
    </div>
    <div id="footer">
      <div class="footer-left">
        <p>
        Copyright © 2012-2016 Tanky Woo.
        Powered by <a href="http://simiki.org/" target="_blank">Simiki</a>.
        Theme by <a href="https://git.coding.net/tankywoo/yasimple_x2.git" target="_blank">YASimple_X2</a>.
        </p>
        <p>本作品采用<a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议</a>进行许可。</p>
      </div> <!-- end footer-left -->
      <div class="footer-right">
        <p>站点最后生成 2016-09-20 09:11:55</p>
        <p><a href="https://github.com/tankywoo/wiki.tankywoo.com">Fork me on Github</a></p>
        <p><a href="http://www.miitbeian.gov.cn/">京ICP备16016622号</a></p>
      </div> <!-- end footer-right -->
    </div>
    <script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3F754de327571c0ba7ff50a61fc964e196' type='text/javascript'%3E%3C/script%3E"));
    </script>
  </body>
</html>