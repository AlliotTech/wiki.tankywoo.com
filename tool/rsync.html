<!DOCTYPE HTML>
<html>
  <head>
    <link rel="Stylesheet" type="text/css" href="/static/css/colorful.css">
    <link rel="Stylesheet" type="text/css" href="/static/css/style.css">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="alternate" type="application/atom+xml" href="atom.xml" title="Atom feed">
    <title>rsync - Wiki · Tanky Woo</title>
    <meta name="keywords" content="wiki, makrdown, linux, python, cpp, ops, simiki"/>
    <meta name="description" content="Tanky Woo's personal wiki, powered by vim and markdown. Focus on Python, C/C++, Linux, Ops-Dev, Gentoo, and so on."/>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
  </head>

  <body>
    <div id="container" class="typo">
      
<div id="header">
  <div id="post-nav">
    <a href="/">Wiki · Tanky Woo</a>
    &nbsp;&#187;&nbsp;
    <a href="/#tool">tool</a>
    &nbsp;&#187;&nbsp;rsync
    <span class="updated">当前页面最后更新&nbsp;
    2017-11-03 18:06
    
    </span>
  </div>
</div>
<div class="clearfix"></div>
<div id="content">
  <div class="toc"><span class="toctitle">Table of Contents</span><ul>
<li><a href="#_1">使用方式</a><ul>
<li><a href="#_2">本地同步</a></li>
<li><a href="#remote-shell">remote shell方式 远程同步</a></li>
<li><a href="#rsync-daemon">rsync daemon方式 远程同步</a></li>
</ul>
</li>
<li><a href="#_3">常用参数</a></li>
<li><a href="#_4">经验</a><ul>
<li><a href="#hosts-allow-hosts-deny">关于 hosts allow 和 hosts deny</a></li>
<li><a href="#_5">关于认证用户和密码</a></li>
<li><a href="#filter-exclude-exclude-from">关于 filter, exclude, exclude from 等</a></li>
<li><a href="#_6">关于权限问题</a></li>
<li><a href="#rsync">rsync命令行只同步所有子目录指定的文件</a></li>
</ul>
</li>
<li><a href="#troubleshoot">Troubleshoot</a></li>
</ul>
</div>
<p>rsync - a fast, versatile, remote (and local) file-copying tool</p>
<p>广泛用于<code>备份(backup)</code>和<code>镜像(mirror)</code></p>
<p>支持本地或远程复制, 有<code>shell</code>和<code>rsync daemon</code>两种方式</p>
<ul>
<li>remote shell<ul>
<li>via ssh or rsh</li>
<li>the source or destination path contains a single colon (:) separator after a host specification</li>
</ul>
</li>
<li>rsync daemon<ul>
<li>via TCP</li>
<li>the source or destination path contains a double colon (::) separator after a  host  specification</li>
<li>OR  when  an rsync://  URL  is  specified</li>
</ul>
</li>
</ul>
<h2 id="_1">使用方式</h2>
<div class="hlcode"><pre><span class="n">Local</span><span class="o">:</span>
    <span class="n">rsync</span> <span class="o">[</span><span class="n">OPTION</span><span class="o">...]</span> <span class="n">SRC</span><span class="o">...</span> <span class="o">[</span><span class="n">DEST</span><span class="o">]</span>

<span class="n">Access</span> <span class="n">via</span> <span class="n">remote</span> <span class="n">shell</span><span class="o">:</span>
    <span class="n">Pull</span><span class="o">:</span> <span class="n">rsync</span> <span class="o">[</span><span class="n">OPTION</span><span class="o">...]</span> <span class="o">[</span><span class="n">USER</span><span class="err">@</span><span class="o">]</span><span class="n">HOST</span><span class="o">:</span><span class="n">SRC</span><span class="o">...</span> <span class="o">[</span><span class="n">DEST</span><span class="o">]</span>
    <span class="n">Push</span><span class="o">:</span> <span class="n">rsync</span> <span class="o">[</span><span class="n">OPTION</span><span class="o">...]</span> <span class="n">SRC</span><span class="o">...</span> <span class="o">[</span><span class="n">USER</span><span class="err">@</span><span class="o">]</span><span class="n">HOST</span><span class="o">:</span><span class="n">DEST</span>

<span class="n">Access</span> <span class="n">via</span> <span class="n">rsync</span> <span class="n">daemon</span><span class="o">:</span>
    <span class="n">Pull</span><span class="o">:</span> <span class="n">rsync</span> <span class="o">[</span><span class="n">OPTION</span><span class="o">...]</span> <span class="o">[</span><span class="n">USER</span><span class="err">@</span><span class="o">]</span><span class="n">HOST</span><span class="o">::</span><span class="n">SRC</span><span class="o">...</span> <span class="o">[</span><span class="n">DEST</span><span class="o">]</span>
          <span class="n">rsync</span> <span class="o">[</span><span class="n">OPTION</span><span class="o">...]</span> <span class="n">rsync</span><span class="o">://[</span><span class="n">USER</span><span class="err">@</span><span class="o">]</span><span class="n">HOST</span><span class="o">[:</span><span class="n">PORT</span><span class="o">]/</span><span class="n">SRC</span><span class="o">...</span> <span class="o">[</span><span class="n">DEST</span><span class="o">]</span>
    <span class="n">Push</span><span class="o">:</span> <span class="n">rsync</span> <span class="o">[</span><span class="n">OPTION</span><span class="o">...]</span> <span class="n">SRC</span><span class="o">...</span> <span class="o">[</span><span class="n">USER</span><span class="err">@</span><span class="o">]</span><span class="n">HOST</span><span class="o">::</span><span class="n">DEST</span>
          <span class="n">rsync</span> <span class="o">[</span><span class="n">OPTION</span><span class="o">...]</span> <span class="n">SRC</span><span class="o">...</span> <span class="n">rsync</span><span class="o">://[</span><span class="n">USER</span><span class="err">@</span><span class="o">]</span><span class="n">HOST</span><span class="o">[:</span><span class="n">PORT</span><span class="o">]/</span><span class="n">DEST</span>

<span class="n">Usages</span> <span class="k">with</span> <span class="n">just</span> <span class="n">one</span> <span class="n">SRC</span> <span class="n">arg</span> <span class="n">and</span> <span class="n">no</span> <span class="n">DEST</span> <span class="n">arg</span> <span class="n">will</span> <span class="n">list</span> <span class="n">the</span> <span class="n">source</span> <span class="n">files</span> <span class="n">instead</span> <span class="n">of</span> <span class="n">copying</span><span class="o">.</span>
</pre></div>


<h3 id="_2">本地同步</h3>
<div class="hlcode"><pre><span class="n">rsync</span> <span class="p">[</span><span class="n">OPTION</span><span class="p">...]</span> <span class="n">SRC</span><span class="p">...</span> <span class="p">[</span><span class="n">DEST</span><span class="p">]</span>
</pre></div>


<h3 id="remote-shell">remote shell方式 远程同步</h3>
<p>使用一个冒号<code>:</code>分隔主机和目录</p>
<div class="hlcode"><pre><span class="n">Pull</span><span class="o">:</span> <span class="n">rsync</span> <span class="o">[</span><span class="n">OPTION</span><span class="o">...]</span> <span class="o">[</span><span class="n">USER</span><span class="err">@</span><span class="o">]</span><span class="n">HOST</span><span class="o">:</span><span class="n">SRC</span><span class="o">...</span> <span class="o">[</span><span class="n">DEST</span><span class="o">]</span>
<span class="n">Push</span><span class="o">:</span> <span class="n">rsync</span> <span class="o">[</span><span class="n">OPTION</span><span class="o">...]</span> <span class="n">SRC</span><span class="o">...</span> <span class="o">[</span><span class="n">USER</span><span class="err">@</span><span class="o">]</span><span class="n">HOST</span><span class="o">:</span><span class="n">DEST</span>
</pre></div>


<p>可以使用<code>ssh</code>或<code>rsh</code>方式传输</p>
<p>举例:</p>
<div class="hlcode"><pre><span class="cp"># 使用ssh方式, 端口为1234. 传输主机tankywoo的/data目录到本地的/tmp/backup下</span>
<span class="n">rsync</span> <span class="o">-</span><span class="n">e</span> <span class="err">&#39;</span><span class="n">ssh</span> <span class="o">-</span><span class="n">p</span> <span class="mi">1234</span><span class="err">&#39;</span> <span class="n">root</span><span class="err">@</span><span class="n">tankywoo</span><span class="o">:/</span><span class="n">data</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">backup</span><span class="o">/</span>
</pre></div>


<h3 id="rsync-daemon">rsync daemon方式 远程同步</h3>
<p>有两种方式:</p>
<ul>
<li>
<p>使用两个冒号<code>::</code>分隔主机和目录</p>
<div class="hlcode"><pre><span class="n">Pull</span><span class="o">:</span> <span class="n">rsync</span> <span class="o">[</span><span class="n">OPTION</span><span class="o">...]</span> <span class="o">[</span><span class="n">USER</span><span class="err">@</span><span class="o">]</span><span class="n">HOST</span><span class="o">::</span><span class="n">SRC</span><span class="o">...</span> <span class="o">[</span><span class="n">DEST</span><span class="o">]</span>
<span class="n">Push</span><span class="o">:</span> <span class="n">rsync</span> <span class="o">[</span><span class="n">OPTION</span><span class="o">...]</span> <span class="n">SRC</span><span class="o">...</span> <span class="o">[</span><span class="n">USER</span><span class="err">@</span><span class="o">]</span><span class="n">HOST</span><span class="o">::</span><span class="n">DEST</span>
</pre></div>


</li>
<li>
<p>主机前加上<code>rsync://</code>, 后面直接使用<code>/</code>分隔主机和目录, 和目录结构一样</p>
<div class="hlcode"><pre><span class="n">Pull</span><span class="o">:</span> <span class="n">rsync</span> <span class="o">[</span><span class="n">OPTION</span><span class="o">...]</span> <span class="n">rsync</span><span class="o">://[</span><span class="n">USER</span><span class="err">@</span><span class="o">]</span><span class="n">HOST</span><span class="o">[:</span><span class="n">PORT</span><span class="o">]/</span><span class="n">SRC</span><span class="o">...</span> <span class="o">[</span><span class="n">DEST</span><span class="o">]</span>
<span class="n">Push</span><span class="o">:</span> <span class="n">rsync</span> <span class="o">[</span><span class="n">OPTION</span><span class="o">...]</span> <span class="n">SRC</span><span class="o">...</span> <span class="n">rsync</span><span class="o">://[</span><span class="n">USER</span><span class="err">@</span><span class="o">]</span><span class="n">HOST</span><span class="o">[:</span><span class="n">PORT</span><span class="o">]/</span><span class="n">DEST</span>
</pre></div>


</li>
</ul>
<h2 id="_3">常用参数</h2>
<ul>
<li><code>-a</code> - archive mode; 相当于 <code>-rlptgoD</code></li>
<li><code>-r</code> - 递归. 和<code>cp</code>的 -r 参数一样</li>
<li><code>-l</code> - 复制软链接</li>
<li><code>-p</code> - 保持权限不变</li>
<li><code>-t</code> - 保持修改时间不变</li>
<li><code>-g</code> - 保持group组不变</li>
<li><code>-o</code> - 保持owner不变</li>
<li><code>-D</code> - 等价于<code>--devices --specials</code>, 分别是同步设备文件和特殊文件</li>
<li><code>-b</code> - backup. 配合<code>--backup-dir</code>来用.</li>
<li><code>-n</code> - 这个非常有用. 在同步前可以先测试来查看会由哪些变化, 但不实际修改. 类似gentoo emerge时的<code>-pv</code></li>
<li><code>-v</code> - 更详细的输出信息</li>
<li><code>-h</code> - 以human-readable的方式输出数字格式</li>
<li><code>-H</code> - 复制硬链接</li>
<li><code>-E</code> - 保持可执行权限一致</li>
<li><code>-X</code> - 保持扩展属性(extended attributes), 如<code>setattr</code>配置的属性</li>
<li><code>-A</code> - 保持ACL</li>
<li><code>--delete</code> - 删除src没有, 但dest存在的文件. 这是mirror方式需要的, 保持两边所有文件一致.</li>
<li><code>--stats</code> - 输出文件传输的状态</li>
<li><code>--progress</code> - 输出文件传输的进度</li>
<li><code>--exclude-from</code> - 从文件里读取排除在外的文件或目录</li>
<li><code>--numeric-ids</code> - 不映射uid/gid到user/group的名字</li>
<li><code>--list-only</code> - 只列出文件列表, 不同步. 这个和同步时加上<code>-n</code>做pretend有点类似</li>
<li><code>--ignore-existing</code> - 跳过接收端已经存在的文件不做更新</li>
</ul>
<p>列出可用modules(只有module未配置<code>list = no</code>的才会被列出):</p>
<div class="hlcode"><pre><span class="n">rsync</span> <span class="mf">192.168.1.100</span><span class="o">::</span>
</pre></div>


<p>查看文件列表:</p>
<div class="hlcode"><pre><span class="n">rsync</span> <span class="o">--</span><span class="n">list</span><span class="o">-</span><span class="n">only</span> <span class="n">bob</span><span class="err">@</span><span class="mf">192.168.1.100</span><span class="o">::</span><span class="n">mymodule</span>
</pre></div>


<p>常用的mirror同步命令:</p>
<div class="hlcode"><pre><span class="n">rsync</span> <span class="o">-</span><span class="n">hvaHEXA</span> <span class="o">--</span><span class="n">delete</span> <span class="o">--</span><span class="n">stats</span> <span class="o">--</span><span class="n">progress</span> <span class="o">--</span><span class="n">numeric</span><span class="o">-</span><span class="n">ids</span> <span class="o">--</span><span class="n">exclude</span><span class="o">-</span><span class="n">from</span><span class="o">=/</span><span class="n">root</span><span class="o">/</span><span class="n">filter_file</span> <span class="n">tankywoo</span><span class="o">::</span><span class="n">wiki</span> <span class="o">/</span><span class="n">data</span>
</pre></div>


<p>rsyncd 可以配置多个modules, 如:</p>
<div class="hlcode"><pre><span class="k">[mymodule]</span>
    <span class="na">uid</span> <span class="o">=</span> <span class="s">root</span>
<span class="s">    gid = root</span>
<span class="s">    path = /home/test/</span>
<span class="s">    numeric ids = yes</span>
<span class="s">    list = no</span>
<span class="s">    exclude from = /path/to/file</span>
<span class="s">    ignore errors</span>
<span class="s">    auth users = bob</span>
<span class="s">    secrets file = /etc/rsyncd.secrets</span>
<span class="s">    hosts allow = 192.168.1.101</span>
<span class="s">    comment = &quot;for rsyncd test&quot;</span>
</pre></div>


<h2 id="_4">经验</h2>
<h3 id="hosts-allow-hosts-deny">关于 hosts allow 和 hosts deny</h3>
<p>如果只设置了<code>hosts allow</code>, 则不符合的都会拒绝连接(reject).</p>
<p>如果同时设置了<code>hosts allow</code>和<code>hosts deny</code>, 则首先会判断是否符合allow列表, 如果符合则连接, 否则判断deny连接, 如果符合则拒绝, 剩下的都允许连接.</p>
<p>另外, 这两个配置项都可以是全局级的.</p>
<p>逻辑上有点绕, 所以感觉这个如果没有仔细看文档和尝试的话, 容易造成安全问题.</p>
<p>这里也可以使用通配符(wildcards) <code>*</code>.</p>
<h3 id="_5">关于认证用户和密码</h3>
<p><code>auth users</code> 和 <code>secrets file</code> 控制.</p>
<p>前者列出允许连接module的用户, 后者管理用户和密码.</p>
<p>普通的设置只是简单的帐号密码匹配, 这套用户密码体系和本地用户(<code>/etc/passwd</code>)是无关的.</p>
<p>也可以配置<code>groupname matching</code>, 组名使用<code>@</code>前缀, 此时认证用户必须是本地系统上存在的真实用户, 且是这个组下的成员.</p>
<h3 id="filter-exclude-exclude-from">关于 filter, exclude, exclude from 等</h3>
<p>排除的文件路径, 始终是<strong>相对路径</strong>, 相对于path的路径.</p>
<p><code>exclude</code> 配置排除的模式</p>
<p><code>exclude from</code> 配置排除文件, 包含多行排除模式/文件, 一个module只能配置一个此配置项, 配置多个的话以最后一个为主. 但是客户端命令可以指定多个<code>--exclude-from</code>, 且都生效.</p>
<blockquote>
<p>Only one "exclude from" parameter can apply to a given module; if you have multiple exclude-from files, you can specify them as a merge file in the "filter" parameter.</p>
</blockquote>
<p>排除模式可以使用<code>-</code>和<code>+</code>来显示的指定<code>exclude</code>和<code>include</code>.</p>
<p>关于filter和exclude from的区别:</p>
<ul>
<li>filter 必须指定 <code>-</code> 和 <code>+</code>, 而exclude from里的模式默认都是<code>-</code></li>
</ul>
<p>这里还有些疑惑的地方:</p>
<p>如果配置了<code>use chroot = yes</code>, 那么感觉<code>exclude from</code> 以及 <code>filter</code> 指定的文件都应该是相对路径, 相对于path, 但是实际还是要配置绝对路径, 否则报错.</p>
<p>不过, filter是可以显式配置为相对:</p>
<div class="hlcode"><pre><span class="n">filter</span> <span class="o">=</span> <span class="o">:</span> <span class="p">.</span><span class="n">rsync</span><span class="o">-</span><span class="n">filter</span>
</pre></div>


<p>这样就是相对了path配置的路径下的.rsync-filter文件.</p>
<p>另外就是关于:</p>
<blockquote>
<p>you can specify them as a merge file in the "filter" parameter</p>
</blockquote>
<p>这里不清楚怎么使用?  <strong>TODO</strong></p>
<h3 id="_6">关于权限问题</h3>
<p>同步时会看到有些文件报 <code>failed: Permission denied</code>, <code>uid</code> 选项给出了说明:</p>
<blockquote>
<p>The default when run by a super-user is to switch to the system’s "nobody" user.  The default for a non-super-user is to not try to change the user.</p>
</blockquote>
<p>所以需要配置 <code>uid = root</code> (或其它足够的权限)</p>
<h3 id="rsync">rsync命令行只同步所有子目录指定的文件</h3>
<p>例子：</p>
<div class="hlcode"><pre><span class="n">dir</span>
<span class="o">|---</span><span class="n">sub_dir1</span>
<span class="o">|</span>   <span class="o">|-</span><span class="n">file_a</span>
<span class="o">|</span>   <span class="o">|-</span><span class="n">file_b</span>
<span class="o">|</span>   <span class="o">|-</span><span class="n">file_c</span>
<span class="o">|---</span><span class="n">sub_dir2</span>
<span class="o">|</span>   <span class="o">|-</span><span class="n">file_a</span>
<span class="o">|</span>   <span class="o">|-</span><span class="n">file_b</span>
<span class="o">|</span>   <span class="o">|-</span><span class="n">file_c</span>
<span class="o">|---</span><span class="n">sub_dir3</span>
<span class="o">|</span>   <span class="o">|-</span><span class="n">file_a</span>
<span class="o">|</span>   <span class="o">|-</span><span class="n">file_b</span>
<span class="o">|</span>   <span class="o">|-</span><span class="n">file_c</span>
<span class="o">|</span><span class="p">...</span>
</pre></div>


<p>即某个目录下一堆子目录，每个子目录下都有一堆同名文件，现在只想同步各子目录下的 file_b：</p>
<div class="hlcode"><pre><span class="err">$</span> <span class="n">rsync</span> <span class="o">-</span><span class="n">hvarHEXAi</span> <span class="o">--</span><span class="n">stats</span> <span class="o">--</span><span class="n">progress</span> <span class="o">--</span><span class="n">filter</span><span class="o">=</span><span class="s">&quot;+ *file_b&quot;</span> <span class="o">--</span><span class="n">filter</span><span class="o">=</span><span class="s">&quot;+ */&quot;</span> <span class="o">--</span><span class="n">filter</span><span class="o">=</span><span class="s">&quot;- *&quot;</span> <span class="n">root</span><span class="err">@</span><span class="n">server</span><span class="o">:/</span><span class="n">dir</span><span class="o">/</span> <span class="o">/</span><span class="n">dir</span><span class="o">/</span>
</pre></div>


<p>如果是rsync server端，配合 filter 还是比较好弄，记得以前做过。</p>
<p>注意上面 <code>--filter="+ */" --filter="- *"</code> 是个 trick。后者排除所有，前者不排除所有子目录。具体是看了文档<code>PATTERN</code>的描述：</p>
<div class="hlcode"><pre><span class="n">Note</span> <span class="n">that</span><span class="p">,</span> <span class="n">when</span> <span class="n">using</span> <span class="n">the</span> <span class="o">--</span><span class="n">recursive</span> <span class="p">(</span><span class="o">-</span><span class="n">r</span><span class="p">)</span> <span class="n">option</span> <span class="p">(</span><span class="n">which</span> <span class="n">is</span> <span class="n">implied</span> <span class="n">by</span> <span class="o">-</span><span class="n">a</span><span class="p">),</span> <span class="n">every</span> <span class="n">subcomponent</span> <span class="n">of</span> <span class="n">every</span> <span class="n">path</span> <span class="n">is</span> <span class="n">visited</span> <span class="n">from</span> <span class="n">the</span> <span class="n">top</span> <span class="n">down</span><span class="p">,</span> <span class="n">so</span> <span class="n">include</span><span class="o">/</span><span class="n">exclude</span> <span class="n">patterns</span> <span class="n">get</span> <span class="n">applied</span> <span class="n">recursively</span> <span class="n">to</span> <span class="n">each</span> <span class="n">subcomponent</span><span class="err">’</span><span class="n">s</span> <span class="n">full</span> <span class="n">name</span> <span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">g</span><span class="p">.</span> <span class="n">to</span> <span class="n">include</span> <span class="s">&quot;/foo/bar/baz&quot;</span> <span class="n">the</span> <span class="n">subcomponents</span> <span class="s">&quot;/foo&quot;</span> <span class="n">and</span> <span class="s">&quot;/foo/bar&quot;</span> <span class="n">must</span> <span class="n">not</span> <span class="n">be</span> <span class="n">excluded</span><span class="p">).</span> <span class="n">The</span> <span class="n">exclude</span> <span class="n">patterns</span> <span class="n">actually</span> <span class="kt">short</span><span class="o">-</span><span class="n">circuit</span> <span class="n">the</span> <span class="n">directory</span> <span class="n">traversal</span> <span class="n">stage</span> <span class="n">when</span> <span class="n">rsync</span> <span class="n">finds</span> <span class="n">the</span> <span class="n">files</span> <span class="n">to</span> <span class="n">send</span><span class="p">.</span> <span class="n">If</span> <span class="n">a</span> <span class="n">pattern</span> <span class="n">excludes</span> <span class="n">a</span> <span class="n">particular</span> <span class="n">parent</span> <span class="n">directory</span><span class="p">,</span> <span class="n">it</span> <span class="n">can</span> <span class="n">render</span> <span class="n">a</span> <span class="n">deeper</span> <span class="n">include</span> <span class="n">pattern</span> <span class="n">ineffectual</span> <span class="n">because</span> <span class="n">rsync</span> <span class="n">did</span> <span class="n">not</span> <span class="n">descend</span> <span class="n">through</span> <span class="n">that</span> <span class="n">excluded</span> <span class="n">section</span> <span class="n">of</span> <span class="n">the</span> <span class="n">hierarchy</span><span class="p">.</span> <span class="n">This</span> <span class="n">is</span> <span class="n">particularly</span> <span class="n">important</span> <span class="n">when</span> <span class="n">using</span> <span class="n">a</span> <span class="n">trailing</span> <span class="err">’</span><span class="o">*</span><span class="err">’</span> <span class="n">rule</span><span class="p">.</span> <span class="n">For</span> <span class="n">instance</span><span class="p">,</span> <span class="n">this</span> <span class="n">won</span><span class="err">’</span><span class="n">t</span> <span class="n">work</span><span class="o">:</span>

    <span class="o">+</span> <span class="o">/</span><span class="n">some</span><span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">this</span><span class="o">-</span><span class="n">file</span><span class="o">-</span><span class="n">will</span><span class="o">-</span><span class="n">not</span><span class="o">-</span><span class="n">be</span><span class="o">-</span><span class="n">found</span>
    <span class="o">+</span> <span class="o">/</span><span class="n">file</span><span class="o">-</span><span class="n">is</span><span class="o">-</span><span class="n">included</span>
    <span class="o">-</span> <span class="o">*</span>

<span class="n">This</span> <span class="n">fails</span> <span class="n">because</span> <span class="n">the</span> <span class="n">parent</span> <span class="n">directory</span> <span class="s">&quot;some&quot;</span> <span class="n">is</span> <span class="n">excluded</span> <span class="n">by</span> <span class="n">the</span> <span class="err">’</span><span class="o">*</span><span class="err">’</span> <span class="n">rule</span><span class="p">,</span> <span class="n">so</span> <span class="n">rsync</span> <span class="n">never</span> <span class="n">visits</span> <span class="n">any</span> <span class="n">of</span> <span class="n">the</span> <span class="n">files</span> <span class="n">in</span> <span class="n">the</span> <span class="s">&quot;some&quot;</span> <span class="n">or</span> <span class="s">&quot;some/path&quot;</span> <span class="n">directories</span><span class="p">.</span> <span class="n">One</span> <span class="n">solution</span> <span class="n">is</span> <span class="n">to</span> <span class="n">ask</span> <span class="k">for</span> <span class="n">all</span> <span class="n">directories</span> <span class="n">in</span> <span class="n">the</span> <span class="n">hierarchy</span> <span class="n">to</span> <span class="n">be</span> <span class="n">included</span> <span class="n">by</span> <span class="n">using</span> <span class="n">a</span> <span class="n">single</span> <span class="n">rule</span><span class="o">:</span> <span class="s">&quot;+ */&quot;</span> <span class="p">(</span><span class="n">put</span> <span class="n">it</span> <span class="n">somewhere</span> <span class="n">before</span> <span class="n">the</span> <span class="s">&quot;- *&quot;</span> <span class="n">rule</span><span class="p">),</span> <span class="n">and</span> <span class="n">perhaps</span> <span class="n">use</span> <span class="n">the</span> <span class="o">--</span><span class="n">prune</span><span class="o">-</span><span class="n">empty</span><span class="o">-</span><span class="n">dirs</span> <span class="n">option</span><span class="p">.</span> <span class="n">Another</span> <span class="n">solution</span> <span class="n">is</span> <span class="n">to</span> <span class="n">add</span> <span class="n">specific</span> <span class="n">include</span> <span class="n">rules</span> <span class="k">for</span> <span class="n">all</span> <span class="n">the</span> <span class="n">parent</span> <span class="n">dirs</span> <span class="n">that</span> <span class="n">need</span> <span class="n">to</span> <span class="n">be</span> <span class="n">visited</span><span class="p">.</span> <span class="n">For</span> <span class="n">instance</span><span class="p">,</span> <span class="n">this</span> <span class="n">set</span> <span class="n">of</span> <span class="n">rules</span> <span class="n">works</span> <span class="n">fine</span><span class="o">:</span>

    <span class="o">+</span> <span class="o">/</span><span class="n">some</span><span class="o">/</span>
    <span class="o">+</span> <span class="o">/</span><span class="n">some</span><span class="o">/</span><span class="n">path</span><span class="o">/</span>
    <span class="o">+</span> <span class="o">/</span><span class="n">some</span><span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">this</span><span class="o">-</span><span class="n">file</span><span class="o">-</span><span class="n">is</span><span class="o">-</span><span class="n">found</span>
    <span class="o">+</span> <span class="o">/</span><span class="n">file</span><span class="o">-</span><span class="n">also</span><span class="o">-</span><span class="n">included</span>
    <span class="o">-</span> <span class="o">*</span>
</pre></div>


<h2 id="troubleshoot">Troubleshoot</h2>
<blockquote>
<p>rsync: didn't get server startup line</p>
</blockquote>
<p>测试时配置的<code>exclude from</code>是一个无效路径, 导致这个错误</p>
<blockquote>
<p>auth failed on module xxx</p>
</blockquote>
<p>见 <a href="http://blog.tankywoo.com/linux/2013/12/07/rsync-auth-failed-on-module-xxx.html">rsync auth failed on module xxx 问题总结</a></p>
  
</div>
    </div>
    <div id="footer">
      <div class="footer-left">
        <p>
        Copyright © 2012-2017 Tanky Woo.
        Powered by <a href="http://simiki.org/" target="_blank">Simiki</a>.
        Theme by <a href="https://github.com/tankywoo/yasimple_x2" target="_blank">YASimple_X2</a>.
        </p>
        <p>本作品采用<a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议</a>进行许可。</p>
      </div> <!-- end footer-left -->
      <div class="footer-right">
        <p>站点最后生成 2017-12-20 17:19:45</p>
        <p><a href="https://github.com/tankywoo/wiki.tankywoo.com">Fork me on Github</a></p>
        <p><a href="http://www.miitbeian.gov.cn/">京ICP备16016622号</a></p>
      </div> <!-- end footer-right -->
    </div>

    
    

    <script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3F754de327571c0ba7ff50a61fc964e196' type='text/javascript'%3E%3C/script%3E"));
    </script>
  </body>
</html>